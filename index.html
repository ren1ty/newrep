<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>MARGIC Portal — кейсы как миры</title>
  <meta name="theme-color" content="#0B0E13" />
  <link rel="preconnect" href="https://unpkg.com">
  <style>
    :root{
      --bg:#0B0E13; --surface:#12161F; --txt:#e6eef9; --muted:#9aa7b3;
      --blue:#4DA3FF; --pink:#FF3DF2; --lime:#67FF9A; --glass:rgba(18,22,31,.6);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--txt);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    canvas{display:block}
    .ui{position:fixed;inset:0;pointer-events:none;display:flex;flex-direction:column;justify-content:space-between;padding:16px}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{pointer-events:auto;display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.06em}
    .brand .dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(135deg,var(--blue),var(--pink));box-shadow:0 0 14px rgba(77,163,255,.7)}
    .chip{pointer-events:auto;background:var(--glass);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.08);
      border-radius:14px;padding:10px 14px;box-shadow:0 8px 28px rgba(0,0,0,.35)}
    .actions{display:flex;gap:10px;align-items:center}
    .btn{pointer-events:auto;background:#ffffff;color:#000;border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--txt);border:1px solid rgba(255,255,255,.12)}
    .hint{opacity:.8;font-size:13px}
    .panel{pointer-events:auto;max-width:820px;margin:0 auto;background:var(--glass);border:1px solid rgba(255,255,255,.08);
      border-radius:16px;padding:16px;box-shadow:0 18px 40px rgba(0,0,0,.45)}
    .panel h2{margin:0 0 8px 0;font-family:'Space Grotesk',Inter,system-ui,Arial,sans-serif;letter-spacing:-.02em}
    .panel p{margin:6px 0;color:var(--muted)}
    .cards{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;margin-top:10px}
    .card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:12px}
    .card b{color:#fff}
    .cta{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    .footer{display:flex;justify-content:center}
    .badge{font-size:12px;opacity:.8}
    .tooltip{position:fixed;left:50%;transform:translateX(-50%);bottom:88px;pointer-events:none;
      background:var(--glass);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:8px 12px;font-size:14px;display:none}
    .tooltip.show{display:block}
    .overlay{
      position:fixed;inset:0;pointer-events:none;opacity:0;transition:opacity .5s ease;
      background: radial-gradient(60% 60% at 50% 50%, rgba(77,163,255,.25), rgba(255,61,242,.2) 50%, rgba(11,14,19,1) 70%);
    }
    .overlay.show{opacity:1}
    @media (max-width:700px){
      .cards{grid-template-columns:1fr}
      .ui{padding:12px}
    }
  </style>
</head>
<body>
  <div class="ui">
    <div class="topbar">
      <div class="brand chip"><span class="dot"></span> MARGIC</div>
      <div class="actions">
        <div class="chip hint" id="hint">Наведите на портал и кликните, чтобы войти</div>
        <button id="backBtn" class="btn ghost" style="display:none">← В хаб</button>
      </div>
    </div>

    <div id="worldPanel" class="panel" style="display:none">
      <h2 id="worldTitle">Заголовок мира</h2>
      <p id="worldHook">Короткий хук</p>
      <div class="cards">
        <div class="card"><b>Задача</b><p id="wTask"></p></div>
        <div class="card"><b>Решение</b><p id="wSolution"></p></div>
        <div class="card"><b>Результат</b><p id="wResult"></p></div>
        <div class="card"><b>Контекст</b><p id="wContext"></p></div>
      </div>
      <div class="cta">
        <a id="wPrimary" class="btn" target="_blank" rel="noopener">Открыть демо</a>
        <a id="wSecondary" class="btn ghost" target="_blank" rel="noopener">Связаться</a>
      </div>
    </div>

    <div class="footer">
      <div class="badge chip">РЕШАЕМ ЗАДАЧИ БИЗНЕСА, ДОПОЛНЯЯ РЕАЛЬНОСТЬ</div>
    </div>
  </div>

  <div id="tooltip" class="tooltip"></div>
  <div id="overlay" class="overlay"></div>

  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js';

    // ------- Content: worlds -------
    const worlds = [
      {
        id:'yauza',
        title:'Необычная реальность — Парк Яуза',
        hook:'AR‑открытие зимнего сезона: технологии становятся частью праздника.',
        task:'Сделать событие, вовлекающее горожан и рассказывающее про AR через эмоции.',
        solution:'WebAR‑активности на площадке: фото‑зоны, интерактивы, быстрый вход без установки приложений.',
        result:'Рост вовлечённости и UGC; интерес к AR‑кейсам; повторные визиты.',
        context:'Площадка «Ростокинский акведук». Проходимость парка — десятки тысяч в день; AR как сцена события.',
        primary:{label:'Смотреть формат', href:'#'},
        secondary:{label:'Запросить активацию', href:'mailto:margic@margic.ru'},
        theme:{sky:'#0B0E13', fog:0.05, gradientA:'#4DA3FF', gradientB:'#FF3DF2'},
        effect:'snow'
      },
      {
        id:'ocean',
        title:'AR‑экспонаты — Приморский океанариум',
        hook:'Когда экспонаты оживают рядом: разглядеть, узнать, запомнить.',
        task:'Сделать экспозицию интерактивной и образовательной без перегруза интерфейсом.',
        solution:'AR‑экспонаты с управлением жестами и краткими фактами. Сканируй QR — взаимодействуй.',
        result:'Больше времени у стендов, выше вовлечённость и отзывы посетителей.',
        context:'Живые карточки видов, масштабирование, смена ракурсов, бережная подача фактов.',
        primary:{label:'Посмотреть демо', href:'#'},
        secondary:{label:'Обсудить внедрение', href:'mailto:margic@margic.ru'},
        theme:{sky:'#0B0E13', fog:0.06, gradientA:'#67FF9A', gradientB:'#4DA3FF'},
        effect:'bubbles'
      },
      {
        id:'table-bld',
        title:'Макет без макета — здание «на столе»',
        hook:'WebAR‑макет: продаёт быстрее, стоит дешевле, работает везде.',
        task:'Показать объект без физического макета, с инфо‑точками и переходом на сайт.',
        solution:'WebAR c точным масштабом и карточками: факты, планировки, CTA «Перейти на сайт».',
        result:'Экономия бюджета и времени принятия решений, удобство демонстрации дистанционно.',
        context:'Открываете ссылку, наводите на поверхность — модель появляется в реальном мире.',
        primary:{label:'Открыть AR‑демо', href:'https://gorg1t.github.io/NativAR'},
        secondary:{label:'Получить консультацию', href:'mailto:margic@margic.ru'},
        theme:{sky:'#0B0E13', fog:0.04, gradientA:'#FF3DF2', gradientB:'#67FF9A'},
        effect:'dust'
      },
      {
        id:'industrial',
        title:'Промышленные AR‑инструкции',
        hook:'Послойный разбор оборудования: наглядно, безопасно, пошагово.',
        task:'Ускорить обучение и снизить ошибки при обслуживании.',
        solution:'AR‑гайды с подсветкой узлов, шагами и безопасными зонами.',
        result:'Выше эффективность, меньше простоя, уверенные действия персонала.',
        context:'Модульная сцена: от общего вида к деталям. Пилотирование на производстве выполнено.',
        primary:{label:'Запросить пилот', href:'mailto:margic@margic.ru'},
        secondary:{label:'Подробнее о подходе', href:'#'},
        theme:{sky:'#0B0E13', fog:0.055, gradientA:'#4DA3FF', gradientB:'#67FF9A'},
        effect:'scan'
      },
      {
        id:'manzherok',
        title:'Манжерок — всесезонный курорт',
        hook:'Нажмите, чтобы начать экскурсию: AR‑маршруты и точки интереса.',
        task:'Собрать «вау‑экскурсию» без очередей и гидов, с понятными подсказками.',
        solution:'Порталы в ключевые зоны, AR‑навигаторы, быстрый старт по QR.',
        result:'Снижение нагрузки на персонал, довольные гости, фото/видео‑контент.',
        context:'Зима/лето — один клик до эмоций. Карта маршрутов и акций.',
        primary:{label:'Пройти мини‑экскурсию', href:'#'},
        secondary:{label:'Связаться с нами', href:'mailto:margic@margic.ru'},
        theme:{sky:'#0B0E13', fog:0.045, gradientA:'#FF3DF2', gradientB:'#4DA3FF'},
        effect:'mist'
      }
    ];

    // ------- Three.js base -------
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 200);
    camera.position.set(0,1.3,3.6);

    const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
    renderer.setPixelRatio(Math.min(devicePixelRatio,2));
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true; controls.dampingFactor = 0.06;
    controls.enablePan = false; controls.minDistance=2; controls.maxDistance=6; controls.target.set(0,1.0,0);

    // Lights and base
    const hemi = new THREE.HemisphereLight(0xffffff, 0x0a0d12, 0.7);
    const dir = new THREE.DirectionalLight(0xffffff, 0.9); dir.position.set(2,3,2);
    scene.add(hemi, dir);

    const floor = new THREE.Mesh(
      new THREE.CircleGeometry(6, 128),
      new THREE.MeshStandardMaterial({ color:0x0f1218, metalness:0.2, roughness:0.9 })
    );
    floor.rotation.x = -Math.PI/2; floor.position.y = 0;
    scene.add(floor);

    scene.fog = new THREE.FogExp2(0x0b0e13, 0.05);

    // ------- Portal shader -------
    const portalUniforms = (a='#4DA3FF', b='#FF3DF2') => ({
      u_time:{value:0}, u_colorA:{value:new THREE.Color(a)}, u_colorB:{value:new THREE.Color(b)},
      u_intensity:{value:0.9}, u_edge:{value:0.16}
    });

    const portalMat = (uni) => new THREE.ShaderMaterial({
      uniforms: uni, transparent:true, side:THREE.DoubleSide,
      vertexShader: `
        varying vec2 vUv;
        void main(){ vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0); }
      `,
      fragmentShader: `
        precision highp float; varying vec2 vUv;
        uniform float u_time; uniform vec3 u_colorA; uniform vec3 u_colorB;
        uniform float u_intensity; uniform float u_edge;

        float ring(vec2 uv, float r, float w){
          float d = length(uv-0.5);
          return smoothstep(r, r-0.002, d) - smoothstep(r-w, r-w-0.002, d);
        }
        float noise(vec2 p){ return fract(sin(dot(p, vec2(12.9898,78.233))) * 43758.5453); }
        void main(){
          vec2 uv = vUv; float t=u_time*0.35;
          float d = length(uv-0.5);
          float swirl = sin((uv.x+uv.y+t)*6.0)*0.02;
          float core = smoothstep(0.48+swirl, 0.0, d);
          float rim = ring(uv, 0.48+0.02*sin(t*2.0), u_edge);
          float n = noise(uv*8.0 + t);
          vec3 grad = mix(u_colorA, u_colorB, uv.y + 0.12*sin(t + uv.x*4.0));
          float glow = (0.6 + 0.4*n) * core * u_intensity;
          vec3 col = grad * glow + vec3(1.0)*rim;
          float alpha = clamp(glow + rim, 0.0, 1.0);
          gl_FragColor = vec4(col, alpha);
        }
      `
    });

    // ------- Hub with portals -------
    const hub = new THREE.Group(); scene.add(hub);

    const portalGeo = new THREE.PlaneGeometry(1.4, 1.9);
    const portals = []; const labels = [];

    const makeLabel = (text)=>{
      const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
      const pad=24, fs=48; ctx.font = `800 ${fs}px "Space Grotesk", Inter, Arial`;
      const w = Math.max(512, Math.min(2048, Math.ceil(ctx.measureText(text).width + pad*2)));
      const h = 160;
      canvas.width = w; canvas.height = h;
      ctx.fillStyle='rgba(18,22,31,0.55)'; ctx.fillRect(0,0,w,h);
      ctx.strokeStyle='rgba(255,255,255,0.12)'; ctx.strokeRect(0,0,w,h);
      ctx.textAlign='center'; ctx.textBaseline='middle';
      const grad = ctx.createLinearGradient(0,0,w,0); grad.addColorStop(0,'#4DA3FF'); grad.addColorStop(1,'#FF3DF2');
      ctx.fillStyle=grad; ctx.fillText(text, w/2, h/2+4);
      const tex = new THREE.Texture(canvas); tex.needsUpdate=true; tex.minFilter=THREE.LinearMipmapLinearFilter; tex.generateMipmaps=true;
      const sp = new THREE.Sprite(new THREE.SpriteMaterial({ map:tex, transparent:true }));
      sp.scale.set(1.6, 1.6*h/w, 1);
      return sp;
    };

    const layout = [
      {x:-2.2, z:-1.2}, {x:0, z:-1.6}, {x:2.2, z:-1.2}, {x:-1.1, z:0.2}, {x:1.1, z:0.2}
    ];

    worlds.forEach((w, i)=>{
      const uni = portalUniforms(w.theme.gradientA, w.theme.gradientB);
      const mat = portalMat(uni);
      const mesh = new THREE.Mesh(portalGeo, mat);
      mesh.position.set(layout[i].x, 1.2, layout[i].z);
      mesh.lookAt(0,1.2,3.2);
      mesh.userData.worldId = w.id;
      mesh.userData.uniforms = uni;
      hub.add(mesh); portals.push(mesh);

      const label = makeLabel(w.title);
      label.position.copy(mesh.position).add(new THREE.Vector3(0,-1.25,0));
      hub.add(label); labels.push(label);
    });

    // Decorative beams
    const beamMat = new THREE.MeshBasicMaterial({ color:0x283041, transparent:true, opacity:0.35 });
    for(let i=0;i<22;i++){
      const bar = new THREE.Mesh(new THREE.BoxGeometry(0.02,0.02,THREE.MathUtils.randFloat(1.2,2.6)), beamMat);
      bar.position.set(THREE.MathUtils.randFloatSpread(5), THREE.MathUtils.randFloat(0.4,2.2), THREE.MathUtils.randFloat(-2.6,0.8));
      scene.add(bar);
    }

    // ------- Worlds -------
    const worldGroups = new Map();
    function buildParticles(type){
      const group = new THREE.Group();
      const count = 220;
      const geo = new THREE.BufferGeometry();
      const positions = new Float32Array(count*3);
      const speeds = new Float32Array(count);
      for(let i=0;i<count;i++){
        positions[i*3+0] = THREE.MathUtils.randFloatSpread(3.2);
        positions[i*3+1] = THREE.MathUtils.randFloat(0.3,2.6);
        positions[i*3+2] = THREE.MathUtils.randFloat(-1.8,0.8);
        speeds[i] = THREE.MathUtils.randFloat(0.08,0.35);
      }
      geo.setAttribute('position', new THREE.BufferAttribute(positions,3));
      geo.setAttribute('speed', new THREE.BufferAttribute(speeds,1));
      let color = 0xffffff, size=0.03, dirY=-1;
      if(type==='snow'){ color=0x9fd7ff; size=0.035; dirY=-1; }
      if(type==='bubbles'){ color=0x67ff9a; size=0.03; dirY=+1; }
      if(type==='dust'){ color=0xffffff; size=0.02; dirY=+0.2; }
      if(type==='scan'){ color=0x4da3ff; size=0.025; dirY=+0.4; }
      if(type==='mist'){ color=0xffcfe9; size=0.03; dirY=+0.15; }
      const mat = new THREE.PointsMaterial({ color, size, transparent:true, opacity:0.7, depthWrite:false });
      const points = new THREE.Points(geo, mat);
      points.userData = { dirY, type };
      group.add(points);
      return group;
    }

    function buildWorld(w){
      const g = new THREE.Group(); g.visible=false; scene.add(g);
      const sky = new THREE.Mesh(
        new THREE.SphereGeometry(30, 64, 64),
        new THREE.MeshBasicMaterial({ color: new THREE.Color(w.theme.sky), side:THREE.BackSide })
      );
      g.add(sky);
      const ring = new THREE.Mesh(
        new THREE.RingGeometry(0.6, 1.6, 64, 1),
        new THREE.MeshBasicMaterial({ color:0x1f2632, transparent:true, opacity:0.5 })
      );
      ring.rotation.x = -Math.PI/2; ring.position.y = 0.02; g.add(ring);
      const totem = new THREE.Mesh(
        new THREE.CylinderGeometry(0.18, 0.22, 0.9, 48),
        new THREE.MeshStandardMaterial({ color:0x2a3445, metalness:0.6, roughness:0.2 })
      );
      totem.position.set(0,0.55,0); g.add(totem);
      const halo = new THREE.Mesh(new THREE.TorusGeometry(0.4, 0.015, 16, 96),
        new THREE.MeshBasicMaterial({ color:new THREE.Color(w.theme.gradientA), transparent:true, opacity:0.9 }));
      halo.position.set(0,1.05,0); g.add(halo);
      const particles = buildParticles(w.effect); g.add(particles);

      worldGroups.set(w.id, g);
    }
    worlds.forEach(buildWorld);

    // ------- UI wiring -------
    const $panel = document.getElementById('worldPanel');
    const $title = document.getElementById('worldTitle');
    const $hook = document.getElementById('worldHook');
    const $task = document.getElementById('wTask');
    const $sol = document.getElementById('wSolution');
    const $res = document.getElementById('wResult');
    const $ctx = document.getElementById('wContext');
    const $p = document.getElementById('wPrimary');
    const $s = document.getElementById('wSecondary');
    const $back = document.getElementById('backBtn');
    const $tip = document.getElementById('tooltip');
    const $overlay = document.getElementById('overlay');
    const $hint = document.getElementById('hint');

    function showWorldUI(w){
      $title.textContent = w.title;
      $hook.textContent = w.hook;
      $task.textContent = w.task;
      $sol.textContent = w.solution;
      $res.textContent = w.result;
      $ctx.textContent = w.context;
      $p.textContent = w.primary.label; $p.href = w.primary.href || '#';
      $s.textContent = w.secondary.label; $s.href = w.secondary.href || '#';
      $panel.style.display = '';
      $back.style.display = '';
      $hint.style.display = 'none';
    }
    function hideWorldUI(){
      $panel.style.display = 'none';
      $back.style.display = 'none';
      $hint.style.display = '';
    }

    // ------- Interactions -------
    const ray = new THREE.Raycaster(); const mouse = new THREE.Vector2();
    let hovered = null, active = { id:null, grp:null };

    function onPointerMove(e){
      const x = e.clientX || (e.touches && e.touches[0].clientX);
      const y = e.clientY || (e.touches && e.touches[0].clientY);
      if(x===undefined) return;
      mouse.x = (x / window.innerWidth) * 2 - 1;
      mouse.y = -(y / window.innerHeight) * 2 + 1;

      if(active.id) return;

      ray.setFromCamera(mouse, camera);
      const ints = ray.intersectObjects(portals, false);
      const hit = ints[0]?.object || null;
      hovered = hit;
      document.body.style.cursor = hovered ? 'pointer' : 'default';
      if(hovered){
        const w = worlds.find(k=>k.id===hovered.userData.worldId);
        $tip.textContent = `Войти: ${w.title}`;
        $tip.classList.add('show');
      } else {
        $tip.classList.remove('show');
      }
    }
    function onClick(){
      if(!hovered || active.id) return;
      enterWorld(hovered.userData.worldId);
    }
    window.addEventListener('mousemove', onPointerMove, {passive:true});
    window.addEventListener('touchmove', onPointerMove, {passive:true});
    window.addEventListener('click', onClick);

    function enterWorld(id){
      const w = worlds.find(x=>x.id===id);
      const g = worldGroups.get(id);
      if(!w || !g) return;
      active.id = id; active.grp = g;

      $overlay.classList.add('show');
      setTimeout(()=>{
        hub.visible = false; labels.forEach(s=>s.visible=false);
        scene.fog.density = w.theme.fog;
        g.visible = true;
        showWorldUI(w);
        $overlay.classList.remove('show');
      }, 450);
    }
    function leaveWorld(){
      if(!active.id) return;
      $overlay.classList.add('show');
      hideWorldUI();
      setTimeout(()=>{
        worldGroups.get(active.id).visible = false;
        active.id = null; active.grp = null;
        hub.visible = true; labels.forEach(s=>s.visible=true);
        scene.fog.density = 0.05;
        $overlay.classList.remove('show');
      }, 380);
    }
    document.getElementById('backBtn').addEventListener('click', leaveWorld);

    // ------- Resize -------
    window.addEventListener('resize', ()=>{
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // ------- Animate -------
    const clock = new THREE.Clock();
    function animate(){
      requestAnimationFrame(animate);
      const t = clock.getElapsedTime();

      portals.forEach(p=>{
        p.userData.uniforms.u_time.value = t;
        p.position.y = 1.2 + Math.sin(t*0.9 + p.position.x)*0.08;
        p.scale.setScalar(1 + 0.02*Math.sin(t*1.2 + p.position.x));
      });

      // particles per world
      worldGroups.forEach((grp, id)=>{
        if(!grp.visible) return;
        grp.children.forEach(child=>{
          if(child.isPoints){
            const pos = child.geometry.attributes.position;
            const speed = child.geometry.attributes.speed;
            const dirY = child.userData.dirY;
            for(let i=0;i<pos.count;i++){
              let y = pos.getY(i) + dirY*speed.getX(i)*0.01;
              if(dirY<0 && y<0.2) y=2.4; // snow down
              if(dirY>0 && y>2.6) y=0.3; // bubbles up
              pos.setY(i, y);
            }
            pos.needsUpdate = true;
          }
        });
      });

      controls.update();
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
